s4n init
s4n create -c Dockerfile --container-tag pyplot --enable-network python code/get_soil.py --geojson data/iowa_counties.geojson --soil_cache data/soil_data.csv
s4n create -c Dockerfile --container-tag pyplot --enable-network python code/get_weather.py --geojson data/iowa_counties.geojson 
s4n create -c Dockerfile --container-tag pyplot --enable-network python code/merge_features.py  --geojson data/iowa_counties.geojson --weather weather.csv --soil soil.csv
s4n create -c Dockerfile --container-tag pyplot --enable-network python code/train_model.py --features county_features.csv --yield data/iowa_yield.csv
s4n create -c Dockerfile --container-tag pyplot --enable-network python code/predict_yields.py --features county_features.csv --model model.pkl --scaler scaler.pkl
s4n create -c Dockerfile --container-tag pyplot --enable-network python code/plot_yields.py --predictions county_predictions.csv --geojson data/iowa_counties.geojson 

s4n create -n demo
s4n connect demo --from @inputs/geojson --to get_soil/geojson
s4n connect demo --from @inputs/soil --to get_soil/soil_cache
s4n connect demo --from @inputs/geojson --to get_weather/geojson
s4n connect demo --from @inputs/geojson --to merge_features/geojson
s4n connect demo --from get_soil/soil --to merge_features/soil
s4n connect demo --from get_weather/weather --to merge_features/weather
s4n connect demo --from @inputs/yield --to train_model/yield
s4n connect demo --from merge_features/county_features --to train_model/features
s4n connect demo --from train_model/model --to predict_yields/model
s4n connect demo --from train_model/scaler --to predict_yields/scaler
s4n connect demo --from merge_features/county_features --to predict_yields/features
s4n connect demo --from predict_yields/county_predictions --to plot_yields/predictions
s4n connect demo --from @inputs/geojson --to plot_yields/geojson
s4n connect demo --from plot_yields/iowa_county_yields --to @outputs/iowa_county_yields
s4n save demo

s4n execute make-template workflows/demo/demo.cwl > inputs.yml
s4n execute local workflows/demo/demo.cwl inputs.yml
s4n execute remote start workflows/demo/demo.cwl inputs.yml
